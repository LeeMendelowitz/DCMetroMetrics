DCMetroMetrics is deployed as an application with Openshift (www.openshift.com).

The "Repo Layout" section of this README has been edited to provide information about
the DC Metro Metrics layout, but the rest of this document provides generic information
about OpenShift.

Repo Layout
===========
wsgi/ - Externally exposed wsgi code goes.

wsgi/static/ - Public static content gets served here. (images and stylesheets)

wsgi/views/ - Bottle Templates for generating html and javascript.

scripts/ - Code for running @MetroEscalators, @MetroHotCars, and generating the
           DCMetroMetrics website. There are 4 separate applications:
             - the web server (bottleApp.py)
             - the MetroEscalators App (runEscalatorApp.py)
             - the MetroHotCars App (hotCarApp.py)
             - the WebPageGenerator App (webPageGenerator.py)
           These are run as Greenlets (micro-threads).
           
           Key files:
           - bottleApp.py handles the website server routes.
           - runEscalatorApp.py:
               This checks the WMATA API for escalator outages,
               updates the MongoDB with escalator changes,
               and tweets on @MetroEscalators.
           - hotCarApp.py:
               This checks Twitter for new tweets about #wmata #hotcar's.
               Updates the MongoDB with hotcar data, and tweets acknowledgements on 
               @MetroHotCars.
           - webPageGenerator.py:
               The WebPageGenerator class generates the webpages on DCMetroMetrics.
               It uses bottle and the templates defined in wsgi/views to generate .html
               and .js files.
           - dbUtils.py: Used throughout to get access to the MongoDB database.
           - test_app.py: Can be run locally to test the application. This will not tweet live.

libs/ - Additional libraries
data/ - Data associated with the app.
        The JSON files are a mongoexport dump of the DC Metro Metrics MongoDB
        They can be imported into a local MongoDB by using importData.py. This way,
        the app can be tested locally.

setup.py - Standard setup.py, specify deps here

.openshift/action_hooks/pre_build - Script that gets run every git push before the build
.openshift/action_hooks/build - Script that gets run every git push as part of the build process (on the CI system if available)
.openshift/action_hooks/deploy - Script that gets run every git push after build but before the app is restarted
.openshift/action_hooks/post_deploy - Script that gets run every git push after the app is restarted

Notes about layout
==================
Every time you push, everything in your remote repo dir gets recreated, please
store long term items (like an sqlite database) in the OpenShift data
directory, which will persist between pushes of your repo.
The OpenShift data directory is accessible relative to the remote repo
directory (../data) or via an environment variable OPENSHIFT_DATA_DIR.


Environment Variables
=====================

OpenShift provides several environment variables to reference for ease
of use.


When embedding a database using 'rhc cartridge add', you can reference
environment variables for username, host and password. Example for mysql:

    os.environ['OPENSHIFT_MYSQL_DB_HOST']      - DB host
    os.environ['OPENSHIFT_MYSQL_DB_PORT']      - DB Port
    os.environ['OPENSHIFT_MYSQL_DB_USERNAME']  - DB Username
    os.environ['OPENSHIFT_MYSQL_DB_PASSWORD']  - DB Password

When embedding a NoSQL database using 'rhc cartridge add', you can
reference environment variables for username, host and password.
Example for MongoDB:
    os.environ['OPENSHIFT_MONGODB_DB_HOST']      - NoSQL DB Host
    os.environ['OPENSHIFT_MONGODB_DB_PORT']      - NoSQL DB Port
    os.environ['OPENSHIFT_MONGODB_DB_USERNAME']  - NoSQL DB Username
    os.environ['OPENSHIFT_MONGODB_DB_PASSWORD']  - NoSQL DB Password

To get a full list of environment variables, simply add a line in your
.openshift/action_hooks/build script that says "export" and push.


Notes about layout
==================
Please leave wsgi, libs and data directories but feel free to create additional
directories if needed.

Note: Every time you push, everything in your remote repo dir gets recreated
please store long term items (like an sqlite database) in ../data which will
persist between pushes of your repo.


Notes about setup.py
====================

Adding deps to the install_requires will have the openshift server actually
install those deps at git push time.
